<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„É´„Éº„É¨„ÉÉ„Éà</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            padding: 20px;
            overflow: hidden;
        }

        h1 {
            color: #fff;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .roulette-container {
            position: relative;
            width: 400px;
            height: 400px;
        }

        .pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #ffd700;
            z-index: 10;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
            transition: transform 0.1s;
        }

        .pointer.tick {
            transform: translateX(-50%) scale(1.2);
        }

        .wheel-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 20px rgba(0,0,0,0.5));
        }

        .segment-path {
            stroke: #fff;
            stroke-width: 2;
        }

        .segment-text {
            fill: #fff;
            font-weight: bold;
            font-size: 16px;
        }

        .spin-btn {
            margin-top: 40px;
            padding: 15px 60px;
            font-size: 1.3rem;
            font-weight: bold;
            color: #fff;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
            transition: all 0.3s ease;
        }

        .spin-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.5);
        }

        .spin-btn:active {
            transform: translateY(0);
        }

        .spin-btn:disabled {
            background: #666;
            cursor: not-allowed;
            box-shadow: none;
        }

        .result {
            margin-top: 30px;
            padding: 20px 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            color: #fff;
            font-size: 1.5rem;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .result .winner {
            color: #ffd700;
            font-weight: bold;
            font-size: 2rem;
            animation: winner-pulse 0.5s ease-in-out infinite alternate;
        }

        @keyframes winner-pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            opacity: 0;
            z-index: 100;
        }

        @keyframes confetti-fall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }

        .drum-roll {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            opacity: 0;
            z-index: 50;
            pointer-events: none;
        }

        .drum-roll.show {
            animation: drum-roll-anim 0.5s ease-out forwards;
        }

        @keyframes drum-roll-anim {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
        }

        .speed-lines {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 500px;
            height: 500px;
            transform: translate(-50%, -50%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .speed-lines.active {
            opacity: 0.3;
        }

        @media (max-width: 500px) {
            .roulette-container {
                width: 300px;
                height: 300px;
            }
            h1 {
                font-size: 1.8rem;
            }
            .segment-text {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <h1>„É´„Éº„É¨„ÉÉ„Éà</h1>

    <div class="roulette-container">
        <div class="pointer" id="pointer"></div>
        <svg class="wheel-svg" id="wheel" viewBox="0 0 400 400"></svg>
    </div>

    <button class="spin-btn" id="spinBtn" onclick="spin()">„Çπ„Éî„É≥!</button>

    <div class="result" id="result">
        „Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„É´„Éº„É¨„ÉÉ„Éà„ÇíÂõû„Åù„ÅÜ!
    </div>

    <div class="drum-roll" id="drumRoll"></div>

    <script>
        const members = ['„É¨„Ç™', '„É†„Çµ„Ç∑', '„Éû„Éü', '„Çø„Ç±„É´', '„É™„Ç´', '„Ç≤„É≥„Çø', '„É°„Ç§', '„Éü„Çµ', '„Ç∑„É•„É≥', '„É®„Ç∑„Ç≠'];

        const colors = [
            '#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6',
            '#1abc9c', '#e67e22', '#34495e', '#e91e63', '#00bcd4'
        ];

        const wheel = document.getElementById('wheel');
        const spinBtn = document.getElementById('spinBtn');
        const result = document.getElementById('result');
        const pointer = document.getElementById('pointer');
        const drumRoll = document.getElementById('drumRoll');

        const centerX = 200;
        const centerY = 200;
        const radius = 190;

        let currentRotation = 0;
        let isSpinning = false;
        let animationId = null;

        // Audio context for tick sounds
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playTick(volume = 0.3) {
            if (!audioCtx) return;

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.frequency.value = 800 + Math.random() * 400;
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(volume, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);

            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.05);
        }

        function playWinSound() {
            if (!audioCtx) return;

            const notes = [523.25, 659.25, 783.99, 1046.50];
            notes.forEach((freq, i) => {
                setTimeout(() => {
                    const oscillator = audioCtx.createOscillator();
                    const gainNode = audioCtx.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioCtx.destination);

                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);

                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.3);
                }, i * 100);
            });
        }

        function polarToCartesian(cx, cy, r, angleDeg) {
            const angleRad = (angleDeg - 90) * Math.PI / 180;
            return {
                x: cx + r * Math.cos(angleRad),
                y: cy + r * Math.sin(angleRad)
            };
        }

        function createArcPath(cx, cy, r, startAngle, endAngle) {
            const start = polarToCartesian(cx, cy, r, endAngle);
            const end = polarToCartesian(cx, cy, r, startAngle);
            const largeArcFlag = endAngle - startAngle <= 180 ? 0 : 1;

            return [
                'M', cx, cy,
                'L', start.x, start.y,
                'A', r, r, 0, largeArcFlag, 0, end.x, end.y,
                'Z'
            ].join(' ');
        }

        function createWheel() {
            const segmentAngle = 360 / members.length;

            members.forEach((member, index) => {
                const startAngle = index * segmentAngle;
                const endAngle = startAngle + segmentAngle;

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', createArcPath(centerX, centerY, radius, startAngle, endAngle));
                path.setAttribute('fill', colors[index]);
                path.setAttribute('class', 'segment-path');
                path.setAttribute('data-index', index);
                wheel.appendChild(path);

                const textAngle = startAngle + segmentAngle / 2;
                const textRadius = radius * 0.65;
                const textPos = polarToCartesian(centerX, centerY, textRadius, textAngle);

                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', textPos.x);
                text.setAttribute('y', textPos.y);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'middle');
                text.setAttribute('class', 'segment-text');
                text.setAttribute('transform', `rotate(${textAngle}, ${textPos.x}, ${textPos.y})`);
                text.textContent = member;
                wheel.appendChild(text);
            });

            const centerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            centerCircle.setAttribute('cx', centerX);
            centerCircle.setAttribute('cy', centerY);
            centerCircle.setAttribute('r', 30);
            centerCircle.setAttribute('fill', '#fff');
            centerCircle.setAttribute('stroke', '#333');
            centerCircle.setAttribute('stroke-width', '3');
            wheel.appendChild(centerCircle);
        }

        function createConfetti() {
            const confettiColors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#ffd700'];

            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-20px';
                    confetti.style.backgroundColor = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.width = (Math.random() * 10 + 5) + 'px';
                    confetti.style.height = (Math.random() * 10 + 5) + 'px';
                    confetti.style.animation = `confetti-fall ${Math.random() * 2 + 2}s linear forwards`;

                    document.body.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 4000);
                }, Math.random() * 500);
            }
        }

        function showDrumRoll(text) {
            drumRoll.textContent = text;
            drumRoll.classList.add('show');
            setTimeout(() => drumRoll.classList.remove('show'), 500);
        }

        function easeOutExpo(t) {
            return t === 1 ? 1 : 1 - Math.pow(2, -10 * t);
        }

        function spin() {
            if (isSpinning) return;

            initAudio();

            isSpinning = true;
            spinBtn.disabled = true;
            result.innerHTML = '„Çπ„Éî„É≥‰∏≠...';

            // Random total rotation (5-10 full rotations + random angle)
            const totalRotations = 5 + Math.random() * 5;
            const extraAngle = Math.random() * 360;
            const totalDegrees = totalRotations * 360 + extraAngle;

            const startRotation = currentRotation;
            const targetRotation = currentRotation + totalDegrees;

            // Animation duration with variation
            const baseDuration = 6000;
            const duration = baseDuration + Math.random() * 2000;

            const startTime = performance.now();
            let lastSegment = -1;
            let showedAlmost = false;

            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // Custom easing - slow down dramatically at the end
                let easedProgress;
                if (progress < 0.7) {
                    easedProgress = easeOutExpo(progress / 0.7) * 0.85;
                } else {
                    // Very slow final stretch
                    const finalProgress = (progress - 0.7) / 0.3;
                    easedProgress = 0.85 + finalProgress * 0.15 * (1 - Math.pow(1 - finalProgress, 3));
                }

                currentRotation = startRotation + totalDegrees * easedProgress;
                wheel.style.transform = `rotate(${currentRotation}deg)`;

                // Calculate current segment for tick sound
                const normalizedRotation = ((currentRotation % 360) + 360) % 360;
                const segmentAngle = 360 / members.length;
                const currentSegment = Math.floor(normalizedRotation / segmentAngle);

                if (currentSegment !== lastSegment) {
                    lastSegment = currentSegment;

                    // Tick sound and pointer animation
                    const volume = progress < 0.8 ? 0.2 : 0.4;
                    playTick(volume);

                    pointer.classList.add('tick');
                    setTimeout(() => pointer.classList.remove('tick'), 50);
                }

                // Show "Almost there!" at 80%
                if (progress > 0.75 && progress < 0.85 && !showedAlmost) {
                    showedAlmost = true;
                    showDrumRoll('„ÇÇ„ÅÜ„Åô„Åê...');
                }

                if (progress < 1) {
                    animationId = requestAnimationFrame(animate);
                } else {
                    // Animation complete
                    finishSpin();
                }
            }

            animationId = requestAnimationFrame(animate);
        }

        function finishSpin() {
            const normalizedRotation = ((currentRotation % 360) + 360) % 360;
            const segmentAngle = 360 / members.length;
            const winnerIndex = Math.floor(((360 - normalizedRotation + segmentAngle / 2) % 360) / segmentAngle);
            const winner = members[winnerIndex];

            // Dramatic pause before reveal
            setTimeout(() => {
                showDrumRoll('üéâ');

                setTimeout(() => {
                    result.innerHTML = `ÂΩìÈÅ∏ËÄÖ: <span class="winner">${winner}</span>`;
                    playWinSound();
                    createConfetti();

                    isSpinning = false;
                    spinBtn.disabled = false;
                }, 300);
            }, 500);
        }

        createWheel();
    </script>
</body>
</html>
